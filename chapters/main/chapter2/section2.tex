\section{Xây dựng Use Case Diagram}
\subsection{Use case Diagram tổng quát}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.]{graphics/main/chapter2/section2/usecasetq.jpg}
    \caption{Use case Diagram tổng quát}
    \label{fig:usecase_overall}
\end{figure}
Các Actor trong Hệ thống bao gồm:
\begin{itemize}[noitemsep]
    \item Customer: Khách hàng sử dụng website để xem và mua sản phẩm mỹ phẩm, quản lý giỏ hàng, đặt hàng, thanh toán, đánh giá sản phẩm và nhận tư vấn từ AI chatbot cùng phân tích khuôn mặt để gợi ý sản phẩm phù hợp.

    \item Admin: Quản trị viên hệ thống sử dụng web admin panel để quản lý toàn bộ hệ thống bao gồm danh mục, sản phẩm, đơn hàng, người dùng, vận chuyển, đánh giá, khuyến mãi và thông tin cửa hàng.

    \item UserBase: Người dùng cơ bản thực hiện các chức năng xác thực như đăng ký tài khoản mới, đăng nhập vào hệ thống, đăng xuất và quản lý thông tin tài khoản cá nhân.
\end{itemize}
%----------------------------------------------------------------Đăng nhập đăng ký---------------
\subsection{Use case Diagram chi tiết về xử lý đăng nhập đăng ký}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{graphics/main/chapter2/section2/usecase_authen.jpg}
    \caption{Use case Diagram người dùng đăng nhập đăng ký}
    \label{fig:usecase_user}
\end{figure}
Dưới đây là các đặc tả use case của người dùng đăng nhập đăng ký.
\begin{table}[H]
    \centering
    \caption{Đặc tả Use Case UC-01: Đăng ký tài khoản}
    \label{tab:uc01}
\begin{tabular}{|p{4cm}|p{11cm}|}
    \hline
    \textbf{Actor} & Customer, Barber Owner \\
    \hline
\textbf{Mô tả} & Người dùng tạo tài khoản mới \\
\hline
\textbf{Tiền điều kiện} & Chưa có tài khoản \\
\hline
\textbf{Luồng chính} & 
1. Nhập thông tin (email, mật khẩu, họ tên) \newline
2. Hệ thống xác thực thông tin \newline
3. Gửi xác thực qua email \newline
4. Click vào link email nhận được \newline
5. Tạo tài khoản thành công \\
\hline
\textbf{Luồng phụ} & 
2a. Thông tin không hợp lệ $\rightarrow$ Hiển thị lỗi \newline
4a. Link sai/hết hạn $\rightarrow$ Gửi lại email \\
\hline
\textbf{Hậu điều kiện} & Tài khoản được tạo và kích hoạt \\
\hline
\end{tabular}
\end{table}



\begin{table}[H]
\centering
\caption{Đặc tả Use Case UC-02: Đăng nhập}
\label{tab:uc02}
\begin{tabular}{|p{4cm}|p{11cm}|}
\hline
\textbf{Actor} & Customer, Barber Owner, Admin \\
\hline
\textbf{Mô tả} & Đăng nhập vào hệ thống \\
\hline
\textbf{Tiền điều kiện} & Có tài khoản hợp lệ \\
\hline
\textbf{Luồng chính} & 
1. Nhập email và mật khẩu \newline
2. Hệ thống xác thực \newline
3. Cấp token truy cập \newline
4. Chuyển đến màn hình chính \\
\hline
\textbf{Luồng phụ} & 
2a. Sai thông tin đăng nhập $\rightarrow$ Thông báo lỗi \newline
2b. Tài khoản bị khóa $\rightarrow$ Thông báo liên hệ admin \\
\hline
\textbf{Hậu điều kiện} & Người dùng truy cập được hệ thống \\
\hline
\end{tabular}
\end{table}



\begin{table}[H]
\centering
\caption{Đặc tả Use Case UC-03: Đăng xuất}
\label{tab:uc03}
\begin{tabular}{|p{4cm}|p{11cm}|}
\hline
\textbf{Actor} & Customer, Barber Owner, Admin \\
\hline
\textbf{Mô tả} & Thoát khỏi hệ thống \\
\hline
\textbf{Luồng chính} & 
1. Chọn đăng xuất \newline
2. Xóa token và session \newline
3. Chuyển về màn hình đăng nhập \\
\hline
\textbf{Hậu điều kiện} & Phiên làm việc kết thúc \\
\hline
\end{tabular}
\end{table}



\begin{table}[H]
\centering
\caption{Đặc tả Use Case UC-04: Quản lý hồ sơ cá nhân}
\label{tab:uc04}
\begin{tabular}{|p{4cm}|p{11cm}|}
\hline
\textbf{Actor} & Customer, Barber Owner \\
\hline
\textbf{Mô tả} & Xem và cập nhật thông tin cá nhân \\
\hline
\textbf{Luồng chính} & 
1. Truy cập hồ sơ cá nhân \newline
2. Xem thông tin hiện tại \newline
3. Chỉnh sửa thông tin (tên, SĐT, ảnh đại diện) \newline
4. Lưu thay đổi \newline
5. Hệ thống cập nhật thành công \\
\hline
\textbf{Luồng phụ} & 
Extend: Cập nhật số điện thoại \newline
Extend: Đổi mật khẩu (yêu cầu mật khẩu cũ) \newline
Extend: Cập nhật ảnh đại diện \\
\hline
\textbf{Hậu điều kiện} & Thông tin cá nhân được cập nhật \\
\hline
\end{tabular}
\end{table}
Hệ thống website thương mại điện tử có hai tác nhân chính tham gia vào quá trình sử dụng hệ thống, bao gồm:
\begin{itemize}
    \item \textbf{Người mua (Customer)}: Là người sử dụng hệ thống để tìm kiếm, lựa chọn sản phẩm, đặt hàng,
    thanh toán, theo dõi đơn hàng và đánh giá sản phẩm.
    \item \textbf{Người bán (Admin/Người quản trị)}: Là người quản lý toàn bộ hoạt động của hệ thống,
    bao gồm quản lý sản phẩm, đơn hàng, người dùng, xử lý giao hàng và theo dõi doanh thu.
\end{itemize}


\subsection{Các nhóm Use Case chính}

Dựa trên yêu cầu chức năng của hệ thống, các Use Case được phân thành các nhóm chính như sau:

\subsubsection{Nhóm Use Case dành cho người mua}

Nhóm Use Case dành cho người mua bao gồm các chức năng hỗ trợ hoạt động mua sắm trực tuyến,
nhằm mang lại trải nghiệm thuận tiện và dễ sử dụng cho khách hàng.

Các Use Case chính bao gồm:
\begin{itemize}
    \item Đăng ký, đăng nhập hệ thống
    \item Duyệt và tìm kiếm sản phẩm
    \item Xem chi tiết sản phẩm
    \item Quản lý giỏ hàng
    \item Đặt hàng và thanh toán
    \item Theo dõi trạng thái đơn hàng
    \item Đánh giá và nhận xét sản phẩm
    \item Nhận tư vấn từ chatbot AI và AI gợi ý sản phẩm phù hợp
\end{itemize}

\subsubsection{Nhóm Use Case dành cho người bán}

Nhóm Use Case dành cho người bán tập trung vào các chức năng quản trị và vận hành hệ thống,
đảm bảo quá trình bán hàng và chăm sóc khách hàng diễn ra hiệu quả.

Các Use Case chính bao gồm:
\begin{itemize}
    \item Quản lý tài khoản người dùng
    \item Quản lý danh mục và sản phẩm
    \item Quản lý đơn hàng
    \item Cập nhật trạng thái giao hàng
    \item Quản lý phương thức thanh toán
    \item Theo dõi thống kê doanh thu và báo cáo tổng hợp
    \item Quản lý đánh giá và phản hồi từ khách hàng
\end{itemize}

\subsection{Sơ đồ Use Case tổng quát của hệ thống}

Sơ đồ Use Case tổng quát thể hiện mối quan hệ giữa các tác nhân và các chức năng chính của hệ thống website thương mại điện tử.
Thông qua sơ đồ, có thể thấy rõ phạm vi chức năng của hệ thống cũng như trách nhiệm của từng tác nhân.

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.95\textwidth]{graphics/front/tmdt.drawio.png}
%     \caption{Sơ đồ Use Case tổng quát của website thương mại điện tử}
%     \label{fig:usecase}
% \end{figure}

\subsection{Nhận xét}

Từ sơ đồ Use Case, có thể nhận thấy hệ thống đáp ứng đầy đủ các yêu cầu chức năng đã được đề cập trong phần
đặc tả yêu cầu hệ thống. Việc phân chia rõ ràng các Use Case theo từng tác nhân giúp hệ thống
dễ dàng mở rộng, bảo trì và phát triển trong tương lai.








\subsection{Use case Diagram chi tiết về xử lý thanh toán}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{graphics/main/chapter2/section2/usecase_vnpay.jpg}
    \caption{Use case Diagram xử lý thanh toán}
    \label{fig:usecase_payment}
\end{figure}
Dưới đây là các đặc tả use case của quy trình thanh toán qua cổng VNPAY.
\begin{table}[H]
\centering
\caption{Đặc tả Use Case: Thanh toán khi nhận hàng (COD)}
\begin{tabular}{|p{4cm}|p{10cm}|}
\hline
\textbf{Thông tin} & \textbf{Mô tả} \\
\hline
Tên Use Case & Thanh toán khi nhận hàng (COD) \\
\hline
Actor & Customer \\
\hline
Mô tả & Khách hàng chọn thanh toán tiền mặt khi nhận hàng \\
\hline
Điều kiện trước & Khách hàng đã thêm sản phẩm vào giỏ hàng và chọn phương thức thanh toán \\
\hline
Luồng chính & 
\begin{enumerate}[noitemsep]
    \item Khách hàng chọn phương thức "Thanh toán khi nhận hàng"
    \item Khách hàng xác nhận đặt hàng
    \item Hệ thống tạo đơn hàng mới với trạng thái "Chờ giao hàng"
    \item Hệ thống hiển thị thông báo đặt hàng thành công
    \item Hệ thống gửi email xác nhận đơn hàng
\end{enumerate} \\
\hline
Điều kiện sau & Đơn hàng được tạo thành công với trạng thái chờ giao hàng \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{Đặc tả Use Case: Thanh toán qua VNPay}
\begin{tabular}{|p{4cm}|p{10cm}|}
\hline
\textbf{Thông tin} & \textbf{Mô tả} \\
\hline
Tên Use Case & Thanh toán qua VNPay \\
\hline
Actor & Customer \\
\hline
Mô tả & Khách hàng thanh toán trực tuyến qua cổng thanh toán VNPay \\
\hline
Điều kiện trước & Khách hàng đã thêm sản phẩm vào giỏ hàng và chọn phương thức thanh toán \\
\hline
Luồng chính & 
\begin{enumerate}[noitemsep]
    \item Khách hàng chọn phương thức "Thanh toán VNPay"
    \item Khách hàng xác nhận thanh toán
    \item Hệ thống tạo đơn hàng tạm thời và mã giao dịch
    \item Hệ thống chuyển hướng khách hàng đến cổng VNPay
    \item Khách hàng nhập thông tin thanh toán và xác nhận
    \item VNPay xử lý giao dịch và gửi kết quả về hệ thống
    \item Hệ thống xác thực chữ ký và cập nhật trạng thái đơn hàng
    \item Hệ thống hiển thị kết quả thanh toán
    \item Hệ thống gửi email xác nhận thanh toán
\end{enumerate} \\
\hline
Luồng thay thế & 
\textbf{6a. Thanh toán thất bại:}
\begin{enumerate}[noitemsep]
    \item VNPay trả về kết quả thất bại
    \item Hệ thống cập nhật trạng thái "Thanh toán thất bại"
    \item Hệ thống hiển thị thông báo lỗi
    \item Đề xuất khách hàng thử lại hoặc chọn phương thức khác
\end{enumerate} \\
\hline
Điều kiện sau & Đơn hàng được tạo với trạng thái "Đã thanh toán" hoặc "Thanh toán thất bại" \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{Đặc tả Use Case: Xem lịch sử đơn hàng}
\begin{tabular}{|p{4cm}|p{10cm}|}
\hline
\textbf{Thông tin} & \textbf{Mô tả} \\
\hline
Tên Use Case & Xem lịch sử đơn hàng \\
\hline
Actor & Customer \\
\hline
Mô tả & Khách hàng xem danh sách các đơn hàng đã đặt \\
\hline
Điều kiện trước & Khách hàng đã đăng nhập vào hệ thống \\
\hline
Luồng chính & 
\begin{enumerate}[noitemsep]
    \item Khách hàng truy cập trang lịch sử đơn hàng
    \item Hệ thống hiển thị danh sách đơn hàng của khách hàng
    \item Khách hàng xem chi tiết từng đơn hàng
\end{enumerate} \\
\hline
Điều kiện sau & Danh sách đơn hàng được hiển thị thành công \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{Đặc tả Use Case: Quản lý đơn hàng}
\begin{tabular}{|p{4cm}|p{10cm}|}
\hline
\textbf{Thông tin} & \textbf{Mô tả} \\
\hline
Tên Use Case & Quản lý đơn hàng \\
\hline
Actor & Admin \\
\hline
Mô tả & Admin quản lý và cập nhật trạng thái các đơn hàng trong hệ thống \\
\hline
Điều kiện trước & Admin đã đăng nhập vào hệ thống \\
\hline
Luồng chính & 
\begin{enumerate}[noitemsep]
    \item Admin truy cập trang quản lý đơn hàng
    \item Hệ thống hiển thị danh sách tất cả đơn hàng
    \item Admin xem chi tiết đơn hàng
    \item Admin cập nhật trạng thái đơn hàng (đang xử lý, đang giao, hoàn thành, hủy)
    \item Hệ thống lưu thay đổi và thông báo cho khách hàng
\end{enumerate} \\
\hline
Điều kiện sau & Trạng thái đơn hàng được cập nhật thành công \\
\hline
\end{tabular}
\end{table}


\subsection{Use case Diagram chi tiết về phân tích da mặt}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{graphics/main/chapter2/section2/usecase_acne.jpg}
    \caption{Use case Diagram phân tích da mặt}
    \label{fig:usecase_acne}
\end{figure}
\begin{table}[H]
\centering
\caption{Đặc tả Use Case: Phân tích Da mặt}
\begin{tabular}{|p{4cm}|p{10cm}|}
\hline
\textbf{Thông tin} & \textbf{Mô tả} \\
\hline
Tên Use Case & Phân tích Da mặt \\
\hline
Actor & Customer \\
\hline
Mô tả & Khách hàng upload ảnh khuôn mặt để phân tích tình trạng da và nhận gợi ý sản phẩm phù hợp \\
\hline
Điều kiện trước & Khách hàng đã đăng nhập vào hệ thống và có ảnh khuôn mặt rõ nét \\
\hline
Luồng chính & 
\begin{enumerate}[noitemsep]
    \item Khách hàng truy cập chức năng phân tích da mặt
    \item Khách hàng upload ảnh khuôn mặt
    \item Hệ thống sử dụng MediaPipe để nhận diện khuôn mặt
    \item Hệ thống cắt từng vùng da mặt (trán, má, mũi, cằm)
    \item Hệ thống sử dụng mô hình CNN để phân tích mụn trên từng vùng
    \item Hệ thống trả về kết quả phân tích chi tiết
    \item Hệ thống đưa ra lời khuyên chăm sóc da
    \item Hệ thống gợi ý các sản phẩm phù hợp với tình trạng da
\end{enumerate} \\
\hline
Luồng thay thế & 
\textbf{3a. Không phát hiện khuôn mặt:}
\begin{enumerate}[noitemsep]
    \item Hệ thống thông báo lỗi "Không tìm thấy khuôn mặt"
    \item Yêu cầu khách hàng upload lại ảnh rõ nét hơn
    \item Quay lại bước 2
\end{enumerate}
\textbf{3b. Ảnh không đủ chất lượng:}
\begin{enumerate}[noitemsep]
    \item Hệ thống thông báo "Ảnh không đủ rõ nét"
    \item Đề xuất khách hàng chụp ảnh trong điều kiện ánh sáng tốt
    \item Quay lại bước 2
\end{enumerate} \\
\hline
Điều kiện sau & Khách hàng nhận được kết quả phân tích da, lời khuyên chăm sóc và danh sách sản phẩm gợi ý \\
\hline
\end{tabular}
\end{table}